/*! show-js-error | © 2020 Denis Seleznev | MIT License */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).showJSError=t()}(this,function(){"use strict";var a="object"==typeof window.screen?window.screen:{};function n(e){var t=document.createElement(e.tag||"div"),n=e.props;for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i]);return t.className=d(e.name),e.container.appendChild(t),t}function d(e,t){var n="show-js-error";return e&&(n+="__"+e),t&&(n+=" "+n+"_"+t),n}function h(e){return(e||"").replace(/[&<>"'/]/g,function(e){return{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"}[e]})}function c(e){return e.error&&e.error.stack||e.stack||""}function i(e,t){return void 0===e?t:e}function l(e){var t=e.filename||"";return void 0!==e.lineno&&(t+=":"+i(e.lineno,""),void 0!==e.colno&&(t+=":"+i(e.colno,""))),t}function _(e){var t=e.message;return e.error&&e.error.name&&"number"in e.error&&(t=e.error.name+": "+t),t}return{init:function(e){if(!this._inited){var r=this,t=/(Android|iPhone|iPod|iPad)/i.test(navigator.userAgent);this.settings=e||{},this._inited=!0,this._isLast=!0,this._i=0,this._buffer=[],this._onerror=function(e){t&&e&&"Script error."===e.message&&!e.lineno&&!e.filename||(r._buffer.push(e),r._isLast&&(r._i=r._buffer.length-1),r._update())},this._onunhandledrejection=function(e){var t=e.reason;r._onerror({message:"Unhandled promise rejection: "+t.message,colno:t.colno,error:t,filename:t.filename,lineno:t.lineno,stack:t.stack})},window.addEventListener?(window.addEventListener("error",this._onerror,!1),window.addEventListener("unhandledrejection",this._onunhandledrejection,!1)):(this._oldOnError=window.onerror,window.onerror=function(e,t,n,i,o){r._onerror({message:e,filename:t,lineno:n,colno:i,error:o}),"function"==typeof r._oldOnError&&r._oldOnError.apply(window,arguments)})}},destruct:function(){this._inited&&(window.addEventListener?(window.removeEventListener("error",this._onerror,!1),window.removeEventListener("unhandledrejection",this._onunhandledrejection,!1)):(window.onerror=this._oldOnError||null,delete this._oldOnError),document.body&&this._container&&document.body.removeChild(this._container),this._buffer=[],this._inited=!1)},show:function(e){void 0!==e&&this._buffer.push("object"==typeof e?e:new Error(e)),this._update(),this._show()},hide:function(){this._container&&(this._container.className=d(""))},toggleDetailed:function(){var e=this._body;e&&(this._toggleDetailed?(this._toggleDetailed=!1,e.className=d("body")):(this._toggleDetailed=!0,e.className=d("body","detailed")))},_append:function(){var t=this;this._container=document.createElement("div"),this._container.className=d(""),this._title=n({name:"title",props:{innerHTML:this._getTitle()},container:this._container}),this._body=n({name:"body",container:this._container}),this._message=n({name:"message",props:{onclick:function(){t.toggleDetailed()}},container:this._body}),this.settings.helpLinks&&(this._helpLinks=n({name:"help",container:this._body}),this._mdn=n({tag:"a",name:"mdn",props:{target:"_blank",innerHTML:"MDN"},container:this._helpLinks}),this._stackoverflow=n({tag:"a",name:"stackoverflow",props:{target:"_blank",innerHTML:"Stack Overflow"},container:this._helpLinks})),this._filename=n({name:"filename",container:this._body}),this.settings.userAgent&&(this._ua=n({name:"ua",container:this._body})),this.settings.additionalText&&(this._additionalText=n({name:"additional-text",container:this._body})),n({name:"close",props:{innerHTML:"×",onclick:function(){t.hide()}},container:this._container}),this._actions=n({name:"actions",container:this._container}),n({tag:"input",name:"copy",props:{type:"button",value:this.settings.copyText||"Copy",onclick:function(){var e=t._buffer[t._i];!function(e){var t=document.createElement("textarea");t.innerHTML=e,document.body.appendChild(t);try{t.select(),document.execCommand("copy")}catch(e){alert("Copying text is not supported in this browser.")}document.body.removeChild(t)}(t._getDetailedMessage(e))}},container:this._actions}),this.settings.sendUrl&&(this._sendLink=n({tag:"a",name:"send-link",props:{href:"",target:"_blank"},container:this._actions}),this._send=n({tag:"input",name:"send",props:{type:"button",value:this.settings.sendText||"Send"},container:this._sendLink})),this._arrows=n({tag:"span",name:"arrows",container:this._actions}),this._prev=n({tag:"input",name:"prev",props:{type:"button",value:"←",onclick:function(){t._isLast=!1,t._i&&t._i--,t._update()}},container:this._arrows}),this._next=n({tag:"input",name:"next",props:{type:"button",value:"→",onclick:function(){t._isLast=!1,t._i<t._buffer.length-1&&t._i++,t._update()}},container:this._arrows}),this._num=n({tag:"span",name:"num",props:{innerHTML:this._i+1},container:this._arrows});var e=function(){document.removeEventListener("DOMContentLoaded",e,!1),document.body.appendChild(t._container)};document.body?e():document.addEventListener?document.addEventListener("DOMContentLoaded",e,!1):document.attachEvent&&document.attachEvent("onload",e)},_getDetailedMessage:function(e){for(var t,n=this.settings,i=[["Title",this._getTitle(e)],["Message",_(e)],["Filename",l(e)],["Stack",c(e)],["Page url",window.location.href],["Refferer",document.referrer],["User-agent",n.userAgent||navigator.userAgent],["Screen size",[a.width,a.height,a.colorDepth].join("×")],["Screen orientation","string"==typeof(t=a.orientation||a.mozOrientation||a.msOrientation||"")?t:t.type],["Cookie enabled",navigator.cookieEnabled]],o="",r=0;r<i.length;r++){var s=i[r];o+=s[0]+": "+s[1]+"\n"}return n.templateDetailedMessage&&(o=n.templateDetailedMessage.replace(/\{message\}/,o)),o},_getTitle:function(e){return e&&e.title||this.settings.title||"JavaScript error"},_show:function(){this._container.className=d("","visible")},_update:function(){this._appended||(this._append(),this._appended=!0);var e,t,n,i,o,r,s=this._buffer[this._i],a=c(s);e=a?h(a).replace(/(at | \(|@)(https?|file)(:.*?)(?=:\d+:\d+\)?$)/gm,function(e,t,n,i){var o=n+i;return t+'<a target="_blank" href="'+o+'">'+o+"</a>"}):(n=(t=s).filename,i=h(l(t)),n&&-1<n.search(/^(https?|file):/)?'<a target="_blank" href="'+h(n)+'">'+i+"</a>":i),this._title.innerHTML=h(this._getTitle(s)),this._message.innerHTML=h(_(s)),this._filename.innerHTML=e,this._ua&&(this._ua.innerHTML=h(this.settings.userAgent)),this._additionalText&&(this._additionalText.innerHTML=h(this.settings.additionalText)),this._sendLink&&(this._sendLink.href=this.settings.sendUrl.replace(/\{title\}/,encodeURIComponent(_(s))).replace(/\{body\}/,encodeURIComponent(this._getDetailedMessage(s)))),1<this._buffer.length&&(this._arrows.className=d("arrows","visible")),this._helpLinks&&(this._mdn.href=(r=s.message||s.stack||"","https://developer.mozilla.org/en-US/search?q="+encodeURIComponent(r)),this._stackoverflow.href=(o="[js] "+(s.message||s.stack||""),"https://stackoverflow.com/search?q="+encodeURIComponent("[js] "+o))),this._prev.disabled=!this._i,this._num.innerHTML=this._i+1+"&thinsp;/&thinsp;"+this._buffer.length,this._next.disabled=this._i===this._buffer.length-1,this._show()}}});